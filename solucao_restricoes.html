<!-- 
SOLUÇÃO FINAL PARA CORREÇÃO DE EVENTOS DE CIDADES E ABAS
Esta versão corrige problemas de eventos de uma cidade aparecendo em outra
-->

<script>
/**
 * Solução completa aprimorada para correção de eventos e abas
 * Esta versão garante que eventos não apareçam nas cidades erradas
 */
(function() {
  // Executar quando o DOM estiver pronto
  document.addEventListener('DOMContentLoaded', function() {
    console.log("[Solução Final] Script de correção iniciado");
    
    // Aplicar correções várias vezes para garantir
    setTimeout(aplicarTodasCorrecoes, 500);
    setTimeout(aplicarTodasCorrecoes, 1500);
    setTimeout(aplicarTodasCorrecoes, 3000);
    
    // Verificar mudanças periodicamente
    setInterval(aplicarTodasCorrecoes, 5000);
    
    // Aplicar correções em resposta a eventos do usuário
    document.addEventListener('click', function() {
      setTimeout(aplicarTodasCorrecoes, 300);
    });
    
    // Para eventos dinâmicos, monitorar mudanças no DOM
    observarMudancas();
  });
  
  // Monitora mudanças no DOM para eventos carregados dinamicamente
  function observarMudancas() {
    // Configurar um MutationObserver para detectar novos elementos
    const observer = new MutationObserver(function(mutations) {
      // Quando houver mudanças, aplicar correções
      setTimeout(aplicarTodasCorrecoes, 100);
    });
    
    // Configurar para observar toda a árvore DOM
    observer.observe(document.body, {
      childList: true,
      subtree: true
    });
    
    console.log("[Solução Final] Observador de mudanças ativado");
  }
  
  // Função principal que aplica todas as correções
  function aplicarTodasCorrecoes() {
    corrigirAbas();
    corrigirEventosCidades();
    removerDatasIncorretas();
  }
  
  // Corrige as abas para mostrar apenas a ativa
  function corrigirAbas() {
    // Injetar CSS crítico para correção das abas
    if (!document.getElementById('correcao-abas-css')) {
      const style = document.createElement('style');
      style.id = 'correcao-abas-css';
      style.textContent = `
        /* Ocultar todas as abas por padrão */
        .bottom-tab-content {
          display: none !important;
        }
        
        /* Mostrar apenas a aba ativa */
        .bottom-tab-content.active-content {
          display: flex !important;
          flex-direction: column !important;
          width: 100% !important;
          height: calc(100vh - 60px) !important;
          overflow-y: auto !important;
          padding: 20px !important;
          box-sizing: border-box !important;
        }
      `;
      document.head.appendChild(style);
      console.log("[Solução Final] CSS para correção de abas injetado");
    }
    
    // Processar abas apenas se o container estiver expandido
    const container = document.querySelector('.bottom-tabs-container');
    if (container && !container.classList.contains('minimized')) {
      // Ocultar todas as abas primeiro
      const abaConteudos = document.querySelectorAll('.bottom-tab-content');
      abaConteudos.forEach(function(aba) {
        aba.style.display = 'none';
        aba.classList.remove('active-content');
      });
      
      // Encontrar o botão ativo
      const botaoAtivo = document.querySelector('.bottom-tab-btn.active');
      if (botaoAtivo) {
        const abaId = botaoAtivo.getAttribute('data-target');
        const abaAtiva = document.getElementById(abaId);
        if (abaAtiva) {
          abaAtiva.style.display = 'flex';
          abaAtiva.classList.add('active-content');
          console.log(`[Solução Final] Aba ativa configurada: ${abaId}`);
        }
      } else {
        // Se nenhum botão estiver ativo, ativar o primeiro
        const primeiroBotao = document.querySelector('.bottom-tab-btn');
        if (primeiroBotao) {
          primeiroBotao.classList.add('active');
          const primeiraAbaId = primeiroBotao.getAttribute('data-target');
          const primeiraAba = document.getElementById(primeiraAbaId);
          if (primeiraAba) {
            primeiraAba.style.display = 'flex';
            primeiraAba.classList.add('active-content');
            console.log(`[Solução Final] Primeira aba ativada: ${primeiraAbaId}`);
          }
        }
      }
    }
  }
  
  // Corrige eventos das cidades e resolve problemas de cruzamento
  function corrigirEventosCidades() {
    console.log("[Solução Final] Verificando eventos de cidades...");
    
    // Mapeamento completo de cidades e suas datas corretas
    const dadosCidades = {
      'Piedade': {
        dataCorreta: '20/05/1840',
        titulo: "Aniversário da Cidade",
        descricao: "Aniversário de fundação de Piedade em 20/05/1840"
      },
      'Ribeirão Preto': {
        dataCorreta: '19/06/1856',
        titulo: "Aniversário da Cidade",
        descricao: "Aniversário de fundação de Ribeirão Preto em 19/06/1856"
      }
      // Adicione outras cidades conforme necessário
    };
    
    // Encontrar todos os eventos
    const eventosItems = document.querySelectorAll('.event-item, .city-event, .evento-item');
    
    // Para cada evento encontrado, verificar e corrigir
    eventosItems.forEach(function(item) {
      // Obter o texto completo do item
      const textoCompleto = item.textContent || item.innerText;
      
      // Buscar elementos importantes dentro do item
      const elementoTitulo = item.querySelector('.event-title, .event-name, .title');
      const elementoData = item.querySelector('.event-date, .date');
      const elementoDesc = item.querySelector('.event-description, .description, .content');
      
      // Verificar se este evento pertence a alguma das cidades mapeadas
      for (const cidade in dadosCidades) {
        // Se o texto contém o nome da cidade
        if (textoCompleto.includes(cidade)) {
          console.log(`[Solução Final] Evento encontrado para cidade: ${cidade}`);
          
          // Corrigir ou ocultar a data
          if (elementoData) {
            elementoData.style.display = 'none'; // Ocultar a data incorreta
          }
          
          // Exibir descrição correta com data completa
          if (elementoDesc) {
            // Atualizar a descrição para incluir a data correta
            elementoDesc.textContent = dadosCidades[cidade].descricao;
            
            // Estilizar a descrição para destacá-la
            elementoDesc.style.fontSize = '1.1em';
            elementoDesc.style.fontWeight = 'bold';
            elementoDesc.style.color = '#e91e63';
            elementoDesc.style.marginTop = '10px';
            
            console.log(`[Solução Final] Descrição atualizada para: ${dadosCidades[cidade].descricao}`);
          }
          
          // Corrigir erros de cruzamento: garantir que o título seja específico da cidade
          if (elementoTitulo && !elementoTitulo.hasAttribute('data-fixed')) {
            elementoTitulo.textContent = `${dadosCidades[cidade].titulo} - ${cidade}`;
            elementoTitulo.setAttribute('data-fixed', 'true');
            console.log(`[Solução Final] Título específico aplicado: ${dadosCidades[cidade].titulo} - ${cidade}`);
          }
          
          // Marcar este item como pertencente a esta cidade para evitar conflitos
          item.setAttribute('data-cidade', cidade);
          break; // Uma vez encontrada a cidade, não verificar outras
        }
      }
    });
  }
  
  // Remove ou oculta elementos de data incorretos
  function removerDatasIncorretas() {
    // Encontrar todos os elementos de data
    const elementosDatas = document.querySelectorAll('.event-date');
    
    elementosDatas.forEach(function(elem) {
      const texto = elem.textContent || elem.innerText;
      
      // Se for Piedade com data incorreta, ocultar
      if (texto.includes('Piedade') && texto.includes('19/05/2025')) {
        elem.style.display = 'none';
        console.log('[Solução Final] Data incorreta de Piedade ocultada');
      }
      
      // Se for Ribeirão Preto com data incorreta, ocultar
      if (texto.includes('Ribeirão Preto') && !texto.includes('19/06/2025')) {
        elem.style.display = 'none';
        console.log('[Solução Final] Data incorreta de Ribeirão Preto ocultada');
      }
    });
    
    // Corrigir eventos específicos que aparecem na cidade errada
    const todosEventos = document.querySelectorAll('.event-item, .city-event');
    todosEventos.forEach(function(evento) {
      const textoEvento = evento.textContent || evento.innerText;
      
      // Se tem Piedade mas menciona Ribeirão Preto na descrição
      if (textoEvento.includes('Piedade') && textoEvento.includes('Ribeirão Preto')) {
        // Encontrar a descrição e corrigir
        const descricao = evento.querySelector('.event-description');
        if (descricao && descricao.textContent.includes('Ribeirão Preto')) {
          descricao.textContent = 'Aniversário de fundação de Piedade em 20/05/1840';
          descricao.style.color = '#e91e63';
          descricao.style.fontWeight = 'bold';
          console.log('[Solução Final] Corrigido evento cruzado: Ribeirão Preto aparecendo em Piedade');
        }
      }
      
      // Se tem Ribeirão Preto mas menciona Piedade na descrição
      if (textoEvento.includes('Ribeirão Preto') && textoEvento.includes('Piedade')) {
        // Encontrar a descrição e corrigir
        const descricao = evento.querySelector('.event-description');
        if (descricao && descricao.textContent.includes('Piedade')) {
          descricao.textContent = 'Aniversário de fundação de Ribeirão Preto em 19/06/1856';
          descricao.style.color = '#e91e63';
          descricao.style.fontWeight = 'bold';
          console.log('[Solução Final] Corrigido evento cruzado: Piedade aparecendo em Ribeirão Preto');
        }
      }
    });
  }
})();
</script>