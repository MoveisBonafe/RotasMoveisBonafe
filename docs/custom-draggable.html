<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Demo Drag and Drop</title>
  <style>
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      padding: 20px;
      background-color: #f8f9fa;
    }
    
    .destinations-list {
      list-style-type: none;
      padding: 0;
      margin: 20px 0;
    }
    
    .destination-item {
      padding: 12px 15px;
      margin-bottom: 10px;
      border-radius: 6px;
      background-color: white;
      border-left: 3px solid #ccc;
      box-shadow: 0 2px 4px rgba(0,0,0,0.1);
      cursor: grab;
      display: flex;
      align-items: center;
    }
    
    .destination-item.origin {
      border-left: 3px solid #ffc107;
      background-color: #fff8e1;
      cursor: default;
    }
    
    .destination-item.dragging {
      opacity: 0.5;
      border: 2px dashed #ffc107;
      cursor: grabbing;
    }
    
    .drag-handle {
      margin-right: 10px;
      color: #aaa;
      font-size: 20px;
      line-height: 1;
    }
    
    .origin .drag-handle {
      color: #ffc107;
    }
    
    button {
      background-color: #ffc107;
      color: black;
      border: none;
      padding: 10px 15px;
      border-radius: 4px;
      cursor: pointer;
      font-weight: 600;
    }
    
    button:hover {
      background-color: #ffab00;
    }
    
    .info {
      padding: 15px;
      background-color: #e9ecef;
      border-radius: 6px;
      margin-bottom: 20px;
    }
    
    .btn-container {
      margin-bottom: 20px;
    }
    
    .btn-secondary {
      background-color: #6c757d;
      color: white;
    }
    
    .btn-secondary:hover {
      background-color: #5a6268;
    }
  </style>
</head>
<body>
  <div class="info">
    <h2>Teste de Drag and Drop</h2>
    <p>Esta página demonstra uma funcionalidade simples de arrastar e soltar para reordenar elementos em uma lista.</p>
    <p>Você pode arrastar os itens para reorganizá-los, exceto o ponto de origem que permance fixo.</p>
  </div>
  
  <div class="btn-container">
    <button id="enable-drag" class="btn-secondary">Ativar Drag and Drop</button>
    <button id="calculate">Calcular Rota</button>
  </div>
  
  <h3>Localizações:</h3>
  <ul id="destinations" class="destinations-list">
    <li class="destination-item origin" data-id="origin">
      <span class="drag-handle">≡</span>
      <span>Dois Córregos (Origem)</span>
    </li>
    <li class="destination-item" data-id="1" draggable="false">
      <span class="drag-handle">≡</span>
      <span>Jaú</span>
    </li>
    <li class="destination-item" data-id="2" draggable="false">
      <span class="drag-handle">≡</span>
      <span>Bauru</span>
    </li>
    <li class="destination-item" data-id="3" draggable="false">
      <span class="drag-handle">≡</span>
      <span>São Carlos</span>
    </li>
    <li class="destination-item" data-id="4" draggable="false">
      <span class="drag-handle">≡</span>
      <span>Araraquara</span>
    </li>
  </ul>
  
  <div id="result"></div>
  
  <script>
    document.addEventListener('DOMContentLoaded', function() {
      const destinationsList = document.getElementById('destinations');
      const enableDragBtn = document.getElementById('enable-drag');
      const calculateBtn = document.getElementById('calculate');
      const resultDiv = document.getElementById('result');
      let dragEnabled = false;
      
      // Função para ativar/desativar drag and drop
      enableDragBtn.addEventListener('click', function() {
        dragEnabled = !dragEnabled;
        
        const destinations = destinationsList.querySelectorAll('.destination-item:not(.origin)');
        
        if (dragEnabled) {
          // Ativar drag and drop
          enableDragBtn.textContent = 'Desativar Drag and Drop';
          enableDragBtn.classList.remove('btn-secondary');
          
          destinations.forEach(item => {
            item.setAttribute('draggable', 'true');
            item.addEventListener('dragstart', handleDragStart);
            item.addEventListener('dragend', handleDragEnd);
          });
          
          destinationsList.addEventListener('dragover', handleDragOver);
          destinationsList.addEventListener('drop', handleDrop);
        } else {
          // Desativar drag and drop
          enableDragBtn.textContent = 'Ativar Drag and Drop';
          enableDragBtn.classList.add('btn-secondary');
          
          destinations.forEach(item => {
            item.setAttribute('draggable', 'false');
            item.removeEventListener('dragstart', handleDragStart);
            item.removeEventListener('dragend', handleDragEnd);
          });
          
          destinationsList.removeEventListener('dragover', handleDragOver);
          destinationsList.removeEventListener('drop', handleDrop);
        }
      });
      
      // Eventos de Drag & Drop
      function handleDragStart(e) {
        this.classList.add('dragging');
        e.dataTransfer.effectAllowed = 'move';
      }
      
      function handleDragEnd() {
        this.classList.remove('dragging');
      }
      
      function handleDragOver(e) {
        e.preventDefault();
        const draggable = document.querySelector('.dragging');
        if (!draggable) return;
        
        const afterElement = getAfterElement(this, e.clientY);
        
        if (afterElement) {
          if (afterElement.classList.contains('origin')) {
            this.insertBefore(draggable, afterElement.nextElementSibling);
          } else {
            this.insertBefore(draggable, afterElement);
          }
        } else {
          this.appendChild(draggable);
        }
      }
      
      function handleDrop(e) {
        e.preventDefault();
      }
      
      function getAfterElement(container, y) {
        const draggableElements = [...container.querySelectorAll('.destination-item:not(.dragging)')];
        
        return draggableElements.reduce((closest, child) => {
          const box = child.getBoundingClientRect();
          const offset = y - box.top - box.height / 2;
          
          if (offset < 0 && offset > closest.offset) {
            return { offset: offset, element: child };
          } else {
            return closest;
          }
        }, { offset: Number.NEGATIVE_INFINITY }).element;
      }
      
      // Calcular rota
      calculateBtn.addEventListener('click', function() {
        const destinations = destinationsList.querySelectorAll('.destination-item');
        const route = [];
        
        destinations.forEach(item => {
          route.push({
            id: item.getAttribute('data-id'),
            name: item.querySelector('span:last-child').textContent
          });
        });
        
        resultDiv.innerHTML = `
          <h3>Rota Calculada:</h3>
          <pre>${JSON.stringify(route, null, 2)}</pre>
        `;
      });
    });
  </script>
</body>
</html>