<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Otimizador de Rotas - GitHub Pages</title>
    <meta name="description" content="Otimizador de Rotas para logÃ­stica e transporte no Brasil, com cÃ¡lculo e visualizaÃ§Ã£o de rotas otimizadas." />
    <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
    <meta http-equiv="Pragma" content="no-cache" />
    <meta http-equiv="Expires" content="0" />
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
        }
        .container-fluid {
            height: 100%;
            padding: 0;
            display: flex;
        }
        .sidebar {
            width: 350px;
            height: 100%;
            overflow-y: auto;
            background-color: #f8f9fa;
            padding: 15px;
            box-shadow: 2px 0 5px rgba(0,0,0,0.1);
        }
        .map-container {
            flex: 1;
            position: relative;
        }
        #map {
            height: 100%;
            width: 100%;
        }
        .error-message {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            text-align: center;
            max-width: 80%;
        }
        .locations-list {
            max-height: 300px;
            overflow-y: auto;
            margin-top: 15px;
        }
        .location-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }
        .location-address {
            font-size: 0.8em;
            color: #666;
        }
        .loading-indicator {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            text-align: center;
            background: white;
            padding: 20px;
            border-radius: 5px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            z-index: 1000;
        }
        .vehicle-options {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 20px;
        }
        .vehicle-card {
            flex: 0 0 calc(33.33% - 10px);
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            cursor: pointer;
            text-align: center;
            transition: all 0.2s ease;
        }
        .vehicle-card:hover {
            border-color: #1976D2;
            background-color: #f0f7ff;
        }
        .vehicle-card.selected {
            border-color: #1976D2;
            background-color: #e3f2fd;
            box-shadow: 0 0 5px rgba(25, 118, 210, 0.5);
        }
        .vehicle-icon {
            font-size: 24px;
            margin-bottom: 5px;
            color: #1976D2;
        }
        .vehicle-name {
            font-size: 12px;
            color: #333;
        }
        @media (max-width: 768px) {
            .container-fluid {
                flex-direction: column;
            }
            .sidebar {
                width: 100%;
                height: auto;
                max-height: 50vh;
            }
        }
    </style>
</head>
<body>
    <div class="container-fluid">
        <div class="sidebar">
            <h3 class="mb-4">Otimizador de Rotas</h3>

            <!-- Buscador de endereÃ§os -->
            <div class="mb-3">
                <label for="location-search" class="form-label">Adicionar localizaÃ§Ã£o</label>
                <div class="input-group">
                    <input type="text" class="form-control" id="location-search" placeholder="Digite um endereÃ§o...">
                    <button class="btn btn-primary" type="button" id="add-location">
                        <i class="bi bi-plus"></i> Adicionar
                    </button>
                </div>
            </div>

            <!-- Importar arquivo -->
            <div class="mb-3 p-3 bg-light border rounded">
                <label for="file-input" class="form-label">Importar localizaÃ§Ãµes</label>
                <div class="input-group mb-2">
                    <input type="file" class="form-control" id="file-input" accept=".txt,.csv">
                    <button class="btn btn-outline-secondary" type="button" id="process-file">Importar</button>
                </div>
                <small class="text-muted">Formato: CEP,Nome (um por linha)</small>
            </div>

            <!-- SeleÃ§Ã£o de veÃ­culo -->
            <div class="mb-3">
                <label class="form-label">Tipo de veÃ­culo</label>
                <div class="vehicle-options" id="vehicle-options">
                    <div class="vehicle-card selected" data-vehicle-id="1">
                        <div class="vehicle-icon">ðŸšš</div>
                        <div class="vehicle-name">CaminhÃ£o 1 eixo</div>
                    </div>
                    <div class="vehicle-card" data-vehicle-id="2">
                        <div class="vehicle-icon">ðŸš›</div>
                        <div class="vehicle-name">CaminhÃ£o 2 eixos</div>
                    </div>
                    <div class="vehicle-card" data-vehicle-id="3">
                        <div class="vehicle-icon">ðŸšš</div>
                        <div class="vehicle-name">Van de carga</div>
                    </div>
                </div>
            </div>

            <!-- Lista de localizaÃ§Ãµes -->
            <h5>Pontos na rota</h5>
            <div class="alert alert-primary" role="alert">
                <strong>Origem:</strong> Dois CÃ³rregos, SP
            </div>
            <div class="locations-list" id="locations-list">
                <!-- LocalizaÃ§Ãµes serÃ£o adicionadas aqui pelo JavaScript -->
            </div>

            <!-- BotÃ£o para otimizar -->
            <button class="btn btn-primary w-100 mt-3" id="optimize-route">
                <span id="optimize-button-text">Otimizar Rota</span>
                <span id="optimize-spinner" class="spinner-border spinner-border-sm ms-2 d-none" role="status"></span>
            </button>
        </div>

        <div class="map-container">
            <div id="map"></div>
            <div id="loading-indicator" class="loading-indicator">
                <div class="spinner-border text-primary mb-3" role="status">
                    <span class="visually-hidden">Carregando...</span>
                </div>
                <h5>Carregando o mapa...</h5>
                <p>Por favor, aguarde enquanto carregamos o Google Maps.</p>
            </div>
        </div>
    </div>

    <!-- Bootstrap -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>

    <script>
        // VariÃ¡veis globais
        let map, directionsService, directionsRenderer, autocomplete;
        let markers = [];
        let locations = [];

        // Inicializa os placeholders imediatamente
        document.addEventListener('DOMContentLoaded', function() {
            console.log("DOM carregado. Preparando para carregar o Google Maps...");
            setupVehicleSelectors();
            initializePlaceholders();
        });

        // FunÃ§Ã£o para inicializar o mapa e componentes relacionados
        function initMap() {
            try {
                console.log("FunÃ§Ã£o initMap chamada");
                document.getElementById('loading-indicator').style.display = 'none';

                // Inicializar o mapa
                map = new google.maps.Map(document.getElementById('map'), {
                    center: { lat: -22.3673, lng: -48.3800 }, // Dois CÃ³rregos, SP
                    zoom: 8,
                    mapTypeControl: true,
                    fullscreenControl: true,
                    streetViewControl: true,
                    zoomControl: true,
                    gestureHandling: 'greedy'
                });

                // Inicializar serviÃ§os
                directionsService = new google.maps.DirectionsService();
                directionsRenderer = new google.maps.DirectionsRenderer({
                    suppressMarkers: true,
                    preserveViewport: true
                });
                directionsRenderer.setMap(map);

                // Inicializar autocomplete
                const input = document.getElementById('location-search');
                autocomplete = new google.maps.places.Autocomplete(input, {
                    types: ['geocode'],
                    componentRestrictions: { country: 'br' }
                });
                autocomplete.addListener('place_changed', onPlaceSelected);

                // Adicionar a origem
                addOriginMarker();

                // Configurar eventos
                setupEventListeners();

                console.log("Mapa inicializado com sucesso!");
            } catch (error) {
                console.error("Erro ao inicializar o mapa:", error);
                showMapError("Houve um erro ao inicializar o mapa: " + error.message);
            }
        }

        // Mostra um erro no mapa
        function showMapError(message) {
            const mapContainer = document.getElementById('map');
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.innerHTML = `
                <h4 class="text-danger">Erro no carregamento do mapa</h4>
                <p>${message}</p>
                <button class="btn btn-primary mt-2" onclick="window.location.reload()">Tentar novamente</button>
            `;
            mapContainer.innerHTML = '';
            mapContainer.appendChild(errorDiv);
        }

        // FunÃ§Ã£o para inicializar elementos antes do carregamento do mapa
        function initializePlaceholders() {
            // Adicionar eventos para os seletores de veÃ­culos
            document.querySelectorAll('.vehicle-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.vehicle-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
            });

            // Adicionar event listener para o botÃ£o de adicionar
            document.getElementById('add-location').addEventListener('click', function() {
                alert('Carregando o mapa... Por favor, aguarde.');
            });

            // Adicionar event listener para o botÃ£o de importar
            document.getElementById('process-file').addEventListener('click', function() {
                alert('Carregando o mapa... Por favor, aguarde.');
            });

            // Adicionar event listener para o botÃ£o de otimizar
            document.getElementById('optimize-route').addEventListener('click', function() {
                alert('Carregando o mapa... Por favor, aguarde.');
            });
        }

        // Configura os seletores de veÃ­culo
        function setupVehicleSelectors() {
            document.querySelectorAll('.vehicle-card').forEach(card => {
                card.addEventListener('click', function() {
                    document.querySelectorAll('.vehicle-card').forEach(c => {
                        c.classList.remove('selected');
                    });
                    this.classList.add('selected');
                });
            });
        }

        // Adiciona o marcador de origem
        function addOriginMarker() {
            const origin = {
                position: { lat: -22.3673, lng: -48.3800 },
                title: "Dois CÃ³rregos, SP",
                isOrigin: true
            };

            const marker = new google.maps.Marker({
                position: origin.position,
                map: map,
                title: origin.title,
                icon: {
                    path: google.maps.SymbolPath.CIRCLE,
                    fillColor: '#FF0000',
                    fillOpacity: 0.9,
                    strokeColor: 'white',
                    strokeWeight: 2,
                    scale: 12
                },
                label: {
                    text: 'O',
                    color: 'white',
                    fontSize: '12px',
                    fontWeight: 'bold'
                }
            });

            markers.push({
                id: 'origin',
                marker: marker,
                isOrigin: true
            });

            map.setCenter(origin.position);
            map.setZoom(12);
        }

        // Configura os event listeners
        function setupEventListeners() {
            document.getElementById('add-location').addEventListener('click', addLocationFromInput);
            document.getElementById('process-file').addEventListener('click', processFile);
            document.getElementById('optimize-route').addEventListener('click', optimizeRoute);
        }

        // Quando um local Ã© selecionado no autocomplete
        function onPlaceSelected() {
            const place = autocomplete.getPlace();
            if (!place || !place.geometry) {
                alert("Por favor, selecione um endereÃ§o vÃ¡lido da lista de sugestÃµes.");
                return;
            }

            const location = {
                id: Date.now(),
                name: place.name || place.formatted_address.split(',')[0],
                address: place.formatted_address,
                latitude: place.geometry.location.lat(),
                longitude: place.geometry.location.lng(),
                isOrigin: false
            };

            addLocation(location);
            document.getElementById('location-search').value = '';
        }

        // Adiciona uma localizaÃ§Ã£o Ã  lista e ao mapa
        function addLocation(location) {
            // Verificar duplicatas
            for (const loc of locations) {
                if (loc.address === location.address) {
                    alert(`LocalizaÃ§Ã£o "${location.name}" jÃ¡ foi adicionada.`);
                    return;
                }
            }

            locations.push(location);
            
            // Criar elemento da lista
            const locationIndex = locations.length;
            const locationItem = document.createElement('div');
            locationItem.className = 'location-item';
            locationItem.dataset.id = location.id;
            
            locationItem.innerHTML = `
                <div>
                    <div><strong>${location.name}</strong></div>
                    <div class="location-address">${location.address}</div>
                </div>
                <button class="btn btn-sm btn-outline-danger remove-location" title="Remover localizaÃ§Ã£o">
                    <i class="bi bi-trash"></i>
                </button>
            `;
            
            // Adicionar evento para remover
            locationItem.querySelector('.remove-location').addEventListener('click', function() {
                removeLocation(location.id);
            });
            
            // Adicionar Ã  lista
            document.getElementById('locations-list').appendChild(locationItem);
            
            // Adicionar marcador ao mapa
            addMarkerForLocation(location, locationIndex);
        }

        // Adiciona um marcador no mapa para uma localizaÃ§Ã£o
        function addMarkerForLocation(location, index) {
            const position = {
                lat: parseFloat(location.latitude),
                lng: parseFloat(location.longitude)
            };
            
            // Configurar o Ã­cone do marcador
            const icon = {
                path: google.maps.SymbolPath.CIRCLE,
                fillColor: '#1976D2',
                fillOpacity: 0.9,
                strokeColor: 'white',
                strokeWeight: 2,
                scale: 12
            };
            
            // Criar o marcador
            const marker = new google.maps.Marker({
                position: position,
                map: map,
                icon: icon,
                label: {
                    text: index.toString(),
                    color: 'white',
                    fontSize: '12px',
                    fontWeight: 'bold'
                },
                title: location.name,
                animation: google.maps.Animation.DROP
            });
            
            // Adicionar ao array de marcadores
            markers.push({
                id: location.id,
                marker: marker,
                isOrigin: false
            });
            
            // Ajustar o zoom para incluir todos os marcadores
            zoomToFitMarkers();
        }

        // Remove uma localizaÃ§Ã£o da lista e do mapa
        function removeLocation(id) {
            // Remover da lista de localizaÃ§Ãµes
            locations = locations.filter(loc => loc.id !== id);
            
            // Remover da lista visual
            const locationItem = document.querySelector(`.location-item[data-id="${id}"]`);
            if (locationItem) {
                locationItem.remove();
            }
            
            // Remover marcador do mapa
            for (let i = 0; i < markers.length; i++) {
                if (markers[i].id === id) {
                    markers[i].marker.setMap(null);
                    markers.splice(i, 1);
                    break;
                }
            }
            
            // Renumerar os marcadores restantes
            updateMarkerLabels();
            
            // Limpar rota se existir
            if (directionsRenderer) {
                directionsRenderer.setDirections({routes: []});
            }
        }

        // Atualiza as labels dos marcadores
        function updateMarkerLabels() {
            let index = 1;
            for (const markerObj of markers) {
                if (!markerObj.isOrigin) {
                    markerObj.marker.setLabel({
                        text: index.toString(),
                        color: 'white',
                        fontSize: '12px',
                        fontWeight: 'bold'
                    });
                    index++;
                }
            }
        }

        // Processa o arquivo de localizaÃ§Ãµes
        function processFile() {
            const fileInput = document.getElementById('file-input');
            const file = fileInput.files[0];
            
            if (!file) {
                alert("Por favor, selecione um arquivo para importar.");
                return;
            }
            
            const reader = new FileReader();
            reader.onload = function(e) {
                const contents = e.target.result;
                parseFileContents(contents);
            };
            reader.readAsText(file);
        }

        // Parse do conteÃºdo do arquivo
        function parseFileContents(contents) {
            // Separar linhas
            const lines = contents.split(/\r?\n/).filter(line => line.trim() !== '');
            
            if (lines.length === 0) {
                alert("Arquivo vazio. Por favor, verifique o conteÃºdo do arquivo.");
                return;
            }
            
            // Processamento de linha-a-linha
            const locationsToAdd = [];
            const errors = [];
            
            lines.forEach((line, index) => {
                // Format: CEP,Nome
                const match = line.match(/^([0-9-]+),(.+)$/);
                
                if (!match) {
                    errors.push(`Linha ${index + 1}: Formato invÃ¡lido. Use "CEP,Nome".`);
                    return;
                }
                
                const cep = match[1].trim();
                const name = match[2].trim();
                
                if (!/^[0-9]{5}-?[0-9]{3}$/.test(cep)) {
                    errors.push(`Linha ${index + 1}: CEP ${cep} invÃ¡lido. Use formato 00000-000 ou 00000000.`);
                    return;
                }
                
                locationsToAdd.push({
                    cep: cep.replace('-', ''),
                    name: name
                });
            });
            
            if (errors.length > 0) {
                alert(`Foram encontrados ${errors.length} erros no arquivo:\n\n${errors.join('\n')}`);
                return;
            }
            
            if (locationsToAdd.length > 0) {
                document.getElementById('optimize-button-text').textContent = "Processando...";
                document.getElementById('optimize-spinner').classList.remove('d-none');
                
                // Processar cada localizaÃ§Ã£o
                processLocations(locationsToAdd)
                    .finally(() => {
                        document.getElementById('optimize-button-text').textContent = "Otimizar Rota";
                        document.getElementById('optimize-spinner').classList.add('d-none');
                        document.getElementById('file-input').value = '';
                    });
            }
        }

        // Processa as localizaÃ§Ãµes do arquivo
        async function processLocations(locationsToAdd) {
            for (const loc of locationsToAdd) {
                try {
                    await geocodeFromCep(loc);
                } catch (error) {
                    console.error("Erro ao geocodificar:", error);
                }
            }
        }

        // Geocodifica um CEP
        function geocodeFromCep(location) {
            return new Promise((resolve) => {
                // NOTA: Em produÃ§Ã£o, vocÃª deve usar uma API real de geocodificaÃ§Ã£o
                // Aqui usamos uma simulaÃ§Ã£o para gerar coordenadas fictÃ­cias
                setTimeout(() => {
                    // Gerar coordenadas aleatÃ³rias baseadas em SP
                    const lat = -23.55 + (Math.random() * 2 - 1);
                    const lng = -46.64 + (Math.random() * 2 - 1);
                    
                    const newLocation = {
                        id: Date.now() + Math.floor(Math.random() * 1000),
                        name: location.name,
                        address: `${location.name}, CEP ${location.cep}, Brasil`,
                        latitude: lat,
                        longitude: lng,
                        isOrigin: false
                    };
                    
                    addLocation(newLocation);
                    resolve(newLocation);
                }, 500);
            });
        }

        // Adiciona localizaÃ§Ã£o a partir do input
        function addLocationFromInput() {
            const inputField = document.getElementById('location-search');
            if (!inputField.value.trim()) {
                return;
            }
            
            const place = autocomplete.getPlace();
            if (!place || !place.geometry) {
                alert("Por favor, selecione um local vÃ¡lido da lista de sugestÃµes.");
                return;
            }
            
            const location = {
                id: Date.now(),
                name: place.name || place.formatted_address.split(',')[0],
                address: place.formatted_address,
                latitude: place.geometry.location.lat(),
                longitude: place.geometry.location.lng(),
                isOrigin: false
            };
            
            addLocation(location);
            inputField.value = '';
        }

        // Otimiza a rota
        function optimizeRoute() {
            // Verificar se hÃ¡ destinos suficientes
            if (locations.length === 0) {
                alert("Adicione pelo menos 1 destino para calcular uma rota.");
                return;
            }
            
            // Encontrar origem (primeiro marcador)
            const origin = markers.find(m => m.isOrigin);
            if (!origin) {
                alert("Origem nÃ£o encontrada.");
                return;
            }
            
            // Encontrar destinos (todos exceto a origem)
            const destinations = markers.filter(m => !m.isOrigin);
            
            // Mostrar spinner
            document.getElementById('optimize-button-text').textContent = "Otimizando...";
            document.getElementById('optimize-spinner').classList.remove('d-none');
            
            // Calculando a soluÃ§Ã£o do caixeiro viajante
            const tspResult = solveTSP(origin.marker.getPosition(), destinations.map(d => d.marker.getPosition()));
            
            // Exibir a rota no mapa
            displayRoute(tspResult.path);
            
            // Esconder spinner
            document.getElementById('optimize-button-text').textContent = "Otimizar Rota";
            document.getElementById('optimize-spinner').classList.add('d-none');
        }

        // ImplementaÃ§Ã£o do algoritmo do Caixeiro Viajante (simplificado)
        function solveTSP(origin, destinations) {
            // Se nÃ£o houver destinos, retornar apenas a origem
            if (destinations.length === 0) {
                return {
                    path: [origin],
                    distance: 0
                };
            }
            
            // HeurÃ­stica do vizinho mais prÃ³ximo
            let currentPoint = origin;
            let unvisited = [...destinations];
            let path = [origin];
            let totalDistance = 0;
            
            // Enquanto houver pontos nÃ£o visitados
            while (unvisited.length > 0) {
                // Encontrar o ponto mais prÃ³ximo
                let closestIdx = 0;
                let closestDistance = calculateDistance(
                    currentPoint.lat(), currentPoint.lng(),
                    unvisited[0].lat(), unvisited[0].lng()
                );
                
                for (let i = 1; i < unvisited.length; i++) {
                    const distance = calculateDistance(
                        currentPoint.lat(), currentPoint.lng(),
                        unvisited[i].lat(), unvisited[i].lng()
                    );
                    
                    if (distance < closestDistance) {
                        closestIdx = i;
                        closestDistance = distance;
                    }
                }
                
                // Adicionar o ponto mais prÃ³ximo Ã  rota
                const nextPoint = unvisited[closestIdx];
                path.push(nextPoint);
                totalDistance += closestDistance;
                
                // Atualizar o ponto atual e remover o ponto visitado
                currentPoint = nextPoint;
                unvisited.splice(closestIdx, 1);
            }
            
            return {
                path: path,
                distance: totalDistance
            };
        }

        // Calcula a distÃ¢ncia entre dois pontos (fÃ³rmula de Haversine)
        function calculateDistance(lat1, lon1, lat2, lon2) {
            const R = 6371; // raio da Terra em km
            const dLat = deg2rad(lat2 - lat1);
            const dLon = deg2rad(lon2 - lon1);
            const a = Math.sin(dLat/2) * Math.sin(dLat/2) +
                      Math.cos(deg2rad(lat1)) * Math.cos(deg2rad(lat2)) * 
                      Math.sin(dLon/2) * Math.sin(dLon/2);
            const c = 2 * Math.atan2(Math.sqrt(a), Math.sqrt(1-a));
            const distance = R * c; // DistÃ¢ncia em km
            return distance;
        }

        // Converte graus para radianos
        function deg2rad(deg) {
            return deg * (Math.PI/180);
        }

        // Exibe a rota no mapa
        function displayRoute(path) {
            if (path.length < 2) return;
            
            // Preparar waypoints
            const waypoints = path.slice(1, path.length - 1).map(point => ({
                location: point,
                stopover: true
            }));
            
            const request = {
                origin: path[0],
                destination: path[path.length - 1],
                waypoints: waypoints,
                optimizeWaypoints: false,
                travelMode: google.maps.TravelMode.DRIVING
            };
            
            directionsService.route(request, function(response, status) {
                if (status === google.maps.DirectionsStatus.OK) {
                    directionsRenderer.setDirections(response);
                    
                    // Mostrar um resumo simplificado
                    showRouteSummary(response);
                } else {
                    alert("NÃ£o foi possÃ­vel calcular a rota: " + status);
                }
            });
        }

        // Mostra um resumo da rota
        function showRouteSummary(response) {
            const route = response.routes[0];
            let totalDistance = 0;
            let totalDuration = 0;
            
            // Calcular distÃ¢ncia e duraÃ§Ã£o totais
            route.legs.forEach(leg => {
                totalDistance += leg.distance.value;
                totalDuration += leg.duration.value;
            });
            
            // Converter para km e horas/minutos
            const distanceKm = (totalDistance / 1000).toFixed(1);
            const durationHours = Math.floor(totalDuration / 3600);
            const durationMinutes = Math.floor((totalDuration % 3600) / 60);
            
            // Mostrar alerta com o resumo
            alert(`Rota otimizada!\n\nDistÃ¢ncia total: ${distanceKm} km\nTempo estimado: ${durationHours}h ${durationMinutes}min`);
        }

        // Ajusta o zoom para incluir todos os marcadores
        function zoomToFitMarkers() {
            if (markers.length === 0) return;
            
            const bounds = new google.maps.LatLngBounds();
            markers.forEach(markerObj => {
                bounds.extend(markerObj.marker.getPosition());
            });
            
            map.fitBounds(bounds);
            
            // Ajuste mÃ­nimo de zoom
            if (map.getZoom() > 15) {
                map.setZoom(15);
            }
        }

        // Trata erros de carregamento da API
        function gm_authFailure() {
            showMapError("Falha na autenticaÃ§Ã£o do Google Maps. Verifique sua chave de API.");
        }

        // FunÃ§Ã£o para lidar com erros de carregamento do script
        function handleScriptError() {
            showMapError("NÃ£o foi possÃ­vel carregar o Google Maps. Verifique sua conexÃ£o com a internet e tente novamente.");
        }
    </script>

    <!-- Carregamento da API do Google Maps no final -->
    <script src="https://maps.googleapis.com/maps/api/js?key=AIzaSyCnallnTQ8gT2_F600vt-yAEv2BoH0mj7U&libraries=places&callback=initMap" 
        async 
        defer
        onerror="handleScriptError()">
    </script>
</body>
</html>